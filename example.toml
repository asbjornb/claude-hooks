# Claude Code Permissions Hook - Example Configuration
# This file demonstrates the shell-parsing approach to permissions

[audit]
# Where to log tool use decisions
audit_file = "/tmp/claude-permissions.json"

# Audit level: "off", "matched" (default), "all"
# - off: no auditing
# - matched: audit only tool use that matched a rule
# - all: audit everything including passthrough
audit_level = "matched"

# =============================================================================
# DENY RULES - Checked first, block dangerous operations
# =============================================================================

# Block push to remote - require manual approval
[[deny]]
tool = "Bash"
description = "Block git push"
commands = ["git push"]

# Block access to sensitive files
[[deny]]
tool = "Read"
description = "Block reading secrets"
path_patterns = ["\\.env$", "\\.secret$", "credentials", "password"]

[[deny]]
tool = "Write"
description = "Block writing to secrets"
path_patterns = ["\\.env$", "\\.secret$", "credentials"]

# =============================================================================
# ALLOW RULES - Commands that should be auto-approved
# =============================================================================

# Git commands - commonly needed
[[allow]]
tool = "Bash"
description = "Git version control"
# Using command signatures: these match regardless of additional args
commands = [
    "git add",
    "git commit", 
    "git status",
    "git diff",
    "git log",
    "git branch",
    "git checkout",
    "git fetch",
    "git pull",
    "git stash",
    "git merge",
    "git rebase",
    "git reset",
    "git show",
]
# Note: git push is intentionally NOT included - approve manually per project

# .NET development commands
[[allow]]
tool = "Bash"
description = "dotnet CLI"
commands = [
    "dotnet build",
    "dotnet run",
    "dotnet test",
    "dotnet restore",
    "dotnet clean",
    "dotnet add",
    "dotnet ef",
    "dotnet tool",
    "dotnet publish",
]
# Wrapper commands - timeout with various values
[[allow]]
tool = "Bash"
description = "timeout wrapper commands"
# Prefix matching means "timeout dotnet" matches "timeout 30 dotnet run"
# and "timeout 45 dotnet run" without per-timeout rules.
commands = [
    "timeout dotnet",
    "timeout npm",
    "timeout node",
    "timeout python",
]
# Node.js development
[[allow]]
tool = "Bash"
description = "Node.js package management"
commands = [
    "npm install",
    "npm run",
    "npm test",
    "npm build",
    "npm start",
    "npm ci",
    "yarn install",
    "yarn run",
    "yarn build",
    "yarn test",
    "pnpm install",
    "pnpm run",
]
# Safe read-only commands
[[allow]]
tool = "Bash"
description = "Safe read-only commands"
commands = [
    "ls",
    "cat",
    "head",
    "tail",
    "grep",
    "find",
    "wc",
    "which",
    "pwd",
    "echo",
    "date",
    "whoami",
]

# GitLab CLI commands
[[allow]]
tool = "Bash"
description = "GitLab CLI"
commands = [
    "glab api",
    "glab ci",
    "glab project",
    "glab repo",
    "glab release",
    "glab variable",
    "glab issue",
    "glab mr",
]
# Database queries (review carefully before allowing)
[[allow]]
tool = "Bash"
description = "Database CLI (review queries)"
commands = [
    "sqlite3",
    "psql -c",
]
#
# Note: This allows any query. If you want to block writes, add explicit deny rules.

# File system operations in specific directories
[[allow]]
tool = "Read"
description = "Read project files"
path_patterns = ["^/mnt/c/code/", "^/home/"]
path_exclude_patterns = ["\\.\\.", "node_modules", "\\.git/objects"]

[[allow]]
tool = "Write"
description = "Write to project files"
path_patterns = ["^/mnt/c/code/", "^/home/"]
path_exclude_patterns = ["\\.\\.", "node_modules", "\\.git/"]

# =============================================================================
# SKILL RULES - Claude Code skills (e.g., /grafana, /gitlab, /jira)
# =============================================================================
# Skills are custom commands in Claude Code. Use "*" to allow all skills,
# or list specific skill names.

# Allow all skills (most permissive)
# [[allow]]
# tool = "Skill"
# description = "Allow all skills"
# commands = ["*"]

# Or allow specific skills
[[allow]]
tool = "Skill"
description = "Observability and project management"
commands = ["grafana", "gitlab", "jira", "history", "pipeline", "repo-db"]

# Block specific skills if needed
# [[deny]]
# tool = "Skill"
# description = "Block risky skill"
# commands = ["some-dangerous-skill"]

# =============================================================================
# COMPOUND COMMANDS
# =============================================================================
# The key feature of this tool: compound commands like "git add -A && git commit -m msg"
# are parsed and each command is validated individually.
#
# - ALLOW: Auto-approved, Claude proceeds without asking
# - DENY: Blocked entirely, Claude cannot proceed, you must do it yourself
# - PASSTHROUGH: Normal behavior, you get the standard permission prompt
#
# Example with the rules above:
#   "git add -A && git commit -m 'message'"  -> ALLOW (both on allow list)
#   "git add -A && git push"                 -> DENY (git push on deny list, blocked)
#   "git add -A && curl example.com"         -> PASSTHROUGH (curl not in any rule, you decide)
